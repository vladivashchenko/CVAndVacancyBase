<!DOCTYPE HTML>
<html>
<head>
    <title>Design studio</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="../Scripts/jquery-3.3.1.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/custom/custom.css" type="text/css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <script>
        $(document).ready(function () {
            GetAllVacancies();
            $("#editVacancy").click(function (event) {
                event.preventDefault();
                EditVacancy();
            });

            $("#addVacancy").click(function (event) {
                event.preventDefault();
                AddVacancy();
            });

        });

        function GetAllVacancies() {
            $("#createBlock").css('display', 'block');
            $("#editBlock").css('display', 'none');
            $.ajax({
                url: '/work-app/vacancies',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    WriteResponse(data);
                },
                error: function (x, y, z) {
                    alert(x + '\n' + y + '\n' + z);
                }
            });
        }
        // Добавление новой книги
        function AddVacancy() {
            // получаем значения для добавляемой книги
            var vacancy = {
                Position: $('#addPosition').val(),
                EmloyerId: $('#addEmloyerId').val(),
                Skills: $('#addSkills').val(),
                Education: $('#addEducation').val(),
                WorkingExperience: $('#addWorkingExperience').val(),
                Goal: $('#addGoal').val(),
                Language: $('#addLanguage').val()
            };

            $.ajax({
                url: '/work-app/vacancies/',
                type: 'POST',
                data: JSON.stringify(vacancy),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    GetAllVacancies();
                },
                error: function (x, y, z) {
                    alert(x + '\n' + y + '\n' + z);
                }
            });
        }
        // Удаление книги
        function DeleteVacancy(id) {

            $.ajax({
                url: '/work-app/vacancies/' + id,
                type: 'DELETE',
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    GetAllVacancies();
                },
                error: function (x, y, z) {
                    alert(x + '\n' + y + '\n' + z);
                }
            });
        }
        // редактирование книги
        function EditVacancy() {
            var id = $('#editId').val();
            // получаем новые значения для редактируемой книги
            var vacancy = {
                Position: $('#editPosition').val(),
                EmloyerId: $('#editEmloyerId').val(),
                Skills: $('#editSkills').val(),
                Education: $('#editEducation').val(),
                WorkingExperience: $('#editWorkingExperience').val(),
                Goal: $('#editGoal').val(),
                Language: $('#editLanguage').val()
            };
            $.ajax({
                url: '/work-app/vacancies/' + id,
                type: 'PUT',
                data: JSON.stringify(vacancy),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    GetAllVacancies();
                },
                error: function (x, y, z) {
                    alert(x + '\n' + y + '\n' + z);
                }
            });
        }
        // вывод полученных данных на экран
        function WriteResponse(vacancies) {
            var strResult = "<table><th>ID</th><th>Name</th>";
            $.each(vacancies, function (index, vacancy) {
                strResult += "<tr><td>" + vacancy.Id + "</td><td> " + vacancy.Position + "</td>" +
                    "<td><a id='editItem' data-item='" + vacancy.Id + "' onclick='EditItem(this);' >Редагувати</a></td>" +
                    "<td><a id='delItem' data-item='" + vacancy.Id + "' onclick='DeleteItem(this);' >Видалити</a></td>"
                    + "</tr>";
            });
            strResult += "</table>";
            $("#tableBlock").html(strResult);

        }
        // обработчик удаления
        function DeleteItem(el) {
            // получаем id удаляемого объекта
            var id = $(el).attr('data-item');
            DeleteVacancy(id);
        }
        // обработчик редактирования
        function EditItem(el) {
            // получаем id редактируемого объекта
            var id = $(el).attr('data-item');
            GetVacancy(id);
        }
        // вывод данных редактируемой книги в поля для редактирования
        function ShowVacancy(vacancy) {
            if (vacancy !== null) {
                $("#createBlock").css('display', 'none');
                $("#editBlock").css('display', 'block');
                $("#editId").val(vacancy.Id);
                $("#editName").val(vacancy.Name);
                $("#editAuthor").val(vacancy.Author);
                $("#editYear").val(vacancy.Year);
            }
            else {
                alert("Not found");
            }
        }
        function GetVacancy(id) {
            $.ajax({
                url: '/work-app/vacancies/' + id,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    ShowVacancy(data);
                },
                error: function (x, y, z) {
                    alert(x + '\n' + y + '\n' + z);
                }
            });
        }
    </script>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark navbar-expand-lg">
        <a class="navbar-brand" href="/work-app/index.html">Design studio</a>
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item active">
                <a class="nav-link" href="/work-app/vacancies.html">Vacancys <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/work-app/designers.html">Designers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/work-app/portfolios.html">Portfolios</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/work-app/services.html">Services</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/work-app/orders.html">Orders</a>
            </li>
        </ul>
    </nav>
    <div id="tableBlock"></div>
    <div id="editBlock">
        <p><b>Edit</b></p>
        <table>
            <tr><td><input type="hidden" id="editId" /></td><td></td></tr>
            <tr><td><label>Position: </label></td><td><input type="text" id="editPosition" /></td></tr>
            <tr><td><label>Skills: </label></td><td><input type="text" id="editSkills" /></td></tr>
            <tr><td><label>Education: </label></td><td><input type="text" id="editEducation" /></td></tr>
            <tr><td><label>WorkingExperience: </label></td><td><input type="text" id="editWorkingExperience" /></td></tr>
            <tr><td><label>Goal: </label></td><td><input type="text" id="editGoal" /></td></tr>
            <tr><td><label>Language: </label></td><td><input type="text" id="editLanguage" /></td></tr>
            <tr><td><input type="hidden" id="addId" /></td><td></td></tr>
        </table>
        <button id="editVacancy">Save</button>
    </div>
    <div id="createBlock">
        <p><b>Add</b></p>
        <table>
            <tr><td><input type="hidden" id="editId" /></td><td></td></tr>
            <tr><td><label>Position: </label></td><td><input type="text" id="addPosition" /></td></tr>
            <tr><td><label>Skills: </label></td><td><input type="text" id="addSkills" /></td></tr>
            <tr><td><label>Education: </label></td><td><input type="text" id="addEducation" /></td></tr>
            <tr><td><label>WorkingExperience: </label></td><td><input type="text" id="addWorkingExperience" /></td></tr>
            <tr><td><label>Goal: </label></td><td><input type="text" id="addGoal" /></td></tr>
            <tr><td><label>Language: </label></td><td><input type="text" id="addLanguage" /></td></tr>
            <tr><td><input type="hidden" id="addEmpoloyerId" /></td><td></td></tr>

        </table>
        <button id="addVacancy">Save</button>
    </div>
</body>
</html>